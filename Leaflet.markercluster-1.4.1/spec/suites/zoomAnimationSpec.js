describe("zoomAnimation",function(){function e(){var e={};for(k in o)e[k]=o[k];e.mobile=!0,L.Browser=e}var n,t,a,r,o;beforeEach(function(){o=L.Browser,r=sinon.useFakeTimers(),(n=document.createElement("div")).style.width="200px",n.style.height="200px",document.body.appendChild(n),(t=L.map(n,{maxZoom:18,trackResize:!1})).fitBounds(new L.LatLngBounds([[1,1],[2,2]]))}),afterEach(function(){a instanceof L.MarkerClusterGroup&&(a.clearLayers(),t.removeLayer(a)),t.remove(),document.body.removeChild(n),r.restore(),n=t=a=r=null}),it("adds the visible marker to the map when zooming in",function(){t.setView(new L.LatLng(-37.36142550190516,174.254150390625),7),a=new L.MarkerClusterGroup({showCoverageOnHover:!0,maxClusterRadius:20,disableClusteringAtZoom:15});var e=new L.Marker([-37.77852090603777,175.3103667497635]);a.addLayer(e),a.addLayer(new L.Marker([-37.711800591811055,174.5003479003906])),t.addLayer(a),r.tick(1e3),t.setView([-37.77852090603777,175.3103667497635],15),r.tick(1e3),expect(e._icon).to.not.be(undefined),expect(e._icon).to.not.be(null)}),it("adds the visible marker to the map when jumping around",function(){a=new L.MarkerClusterGroup;var e=new L.Marker([48.858280181884766,2.2945759296417236]),n=new L.Marker([16.02359962463379,-61.70280075073242]);a.addLayer(e),a.addLayer(n),t.addLayer(a),t.fitBounds(new L.LatLngBounds(new L.LatLng(41.371582,-5.142222),new L.LatLng(51.092804,9.561556))),r.tick(1e3),t.fitBounds(new L.LatLngBounds(new L.LatLng(15.830972671508789,-61.807167053222656),new L.LatLng(16.516849517822266,-61))),r.tick(1e3),expect(n._icon).to.not.be(undefined),expect(n._icon).to.not.be(null)}),it("adds the visible markers to the map, but not parent clusters when jumping around",function(){a=new L.MarkerClusterGroup;var e=new L.Marker([59.952,30.3307]),n=new L.Marker([59.9516,30.3308]),o=new L.Marker([59.9513,30.3312]);a.addLayer(e),a.addLayer(n),a.addLayer(o),t.addLayer(a),t.setView([53.0676,170.6835],16),r.tick(1e3),t.setView(e.getLatLng(),18),r.tick(1e3),expect(e._icon.parentNode).to.be(t._panes.markerPane),expect(n._icon.parentNode).to.be(t._panes.markerPane),expect(o._icon.parentNode).to.be(t._panes.markerPane),expect(t._panes.markerPane.childNodes.length).to.be(3)}),it("removes clicked clusters on the edge of a mobile screen",function(){e();try{t.fitBounds(new L.LatLngBounds([[1,1],[2,2]])),a=new L.MarkerClusterGroup({maxClusterRadius:80}).addTo(t);var n=t.getPixelBounds().max.add([0,1]),i=t.unproject(n),d=t.getCenter().lng,c=new L.LatLng(i.lat,d),s=new L.Marker(c).addTo(a),p=t.getZoom();expect(s._icon).to.be(undefined);for(var u=n.add([0,-79]),l=L.latLng(t.unproject(u).lat,d),k=0;k<10;k+=1)a.addLayer(new L.Marker(l));var m=s.__parent;expect(m._icon.parentNode).to.be(t._panes.markerPane),m.fireEvent("click",null,!0),r.tick(1e3),expect(t.getZoom()).to.equal(p+1),expect(m._icon).to.be(null),expect(t._panes.markerPane.childNodes.length).to.be(2)}finally{L.Browser=o}}),describe("zoomToShowLayer",function(){it("zoom to single marker inside map view",function(){a=new L.MarkerClusterGroup;var e=new L.Marker([59.952,30.3307]);a.addLayer(e),t.addLayer(a);var n=sinon.spy();t.setView(e.getLatLng(),10),r.tick(1e3);var o=t.getCenter(),i=t.getZoom();a.zoomToShowLayer(e,n),r.tick(1e3),expect(e._icon).to.not.be(undefined),expect(e._icon).to.not.be(null),expect(t.getBounds().contains(e.getLatLng())).to.be["true"],expect(t.getCenter()).to.eql(o),expect(t.getZoom()).to.equal(i),sinon.assert.calledOnce(n)}),it("pan map to single marker outside map view",function(){a=new L.MarkerClusterGroup;var e=new L.Marker([59.952,30.3307]);a.addLayer(e),t.addLayer(a);var n=sinon.spy();t.setView([53.0676,170.6835],16),r.tick(1e3);var o=t.getZoom();a.zoomToShowLayer(e,n),r.tick(1e3),expect(e._icon).to.not.be(undefined),expect(e._icon).to.not.be(null),expect(t.getBounds().contains(e.getLatLng())).to.be["true"],expect(t.getCenter()).to.eql(e.getLatLng()),expect(t.getZoom()).to.equal(o),sinon.assert.calledOnce(n)}),it("change view and zoom to marker in cluster inside map view",function(){a=new L.MarkerClusterGroup;var e=new L.Marker([59.952,30.3307]),n=new L.Marker([59.9516,30.3308]),o=new L.Marker([59.9513,30.3312]);a.addLayer(e),a.addLayer(n),a.addLayer(o),t.addLayer(a);var i=sinon.spy();t.setView(e.getLatLng(),16),r.tick(1e3),a.zoomToShowLayer(e,i),r.tick(1e3),expect(e._icon.parentNode).to.be(t._panes.markerPane),expect(n._icon.parentNode).to.be(t._panes.markerPane),expect(o._icon.parentNode).to.be(t._panes.markerPane),expect(t._panes.markerPane.childNodes.length).to.be(3),expect(t.getBounds().contains(e.getLatLng())).to.be["true"],sinon.assert.calledOnce(i)}),it("change view and zoom to marker in cluster outside map view",function(){a=new L.MarkerClusterGroup;var e=new L.Marker([59.952,30.3307]),n=new L.Marker([59.9516,30.3308]),o=new L.Marker([59.9513,30.3312]);a.addLayer(e),a.addLayer(n),a.addLayer(o),t.addLayer(a);var i=sinon.spy();t.setView([53.0676,170.6835],16),r.tick(1e3),a.zoomToShowLayer(e,i),r.tick(1e3),expect(e._icon.parentNode).to.be(t._panes.markerPane),expect(n._icon.parentNode).to.be(t._panes.markerPane),expect(o._icon.parentNode).to.be(t._panes.markerPane),expect(t._panes.markerPane.childNodes.length).to.be(3),expect(t.getBounds().contains(e.getLatLng())).to.be["true"],sinon.assert.calledOnce(i)}),it("spiderfy overlapping markers",function(){a=new L.MarkerClusterGroup;var e=new L.Marker([59.952,30.3307]),n=new L.Marker([59.952,30.3307]),o=new L.Marker([59.952,30.3307]);a.addLayer(e),a.addLayer(n),a.addLayer(o),t.addLayer(a);var i=sinon.spy();t.setView([53.0676,170.6835],16),r.tick(1e3),a.zoomToShowLayer(e,i),r.tick(1e3),expect(e._icon.parentNode).to.be(t._panes.markerPane),expect(n._icon.parentNode).to.be(t._panes.markerPane),expect(o._icon.parentNode).to.be(t._panes.markerPane),expect(t._panes.markerPane.childNodes.length).to.be(4),sinon.assert.calledOnce(i)}),it("zoom or spiderfy markers if they visible on next level of zoom",function(){a=new L.MarkerClusterGroup;var e=new L.Marker([59.952,30.3307]),n=new L.Marker([59.9516,30.3308]),o=new L.Marker([59.9513,30.3312]);a.addLayer(e),a.addLayer(n),a.addLayer(o),t.addLayer(a);var i=sinon.spy();t.setView([59.952,30.3307],17),r.tick(1e3),a.zoomToShowLayer(e,i),r.tick(1e3),expect(e._icon).to.not.be(undefined),expect(e._icon).to.not.be(null),expect(n._icon).to.not.be(undefined),expect(n._icon).to.not.be(null),expect(o._icon).to.not.be(undefined),expect(o._icon).to.not.be(null),sinon.assert.calledOnce(i)})})});