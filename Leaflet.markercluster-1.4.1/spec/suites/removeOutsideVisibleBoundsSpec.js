describe("Option removeOutsideVisibleBounds",function(){function e(){b.addTo(p),b.addLayers(u)}function t(){var e={};for(k in f)e[k]=f[k];e.mobile=!0,L.Browser=e}function o(e,t){for(i=0;i<u.length;i++)t?u[i].setLatLng([-e[i][0],e[i][1]]):u[i].setLatLng(e[i]);p.fitBounds([[t?-86:85,-1],[t?-85:86,1]])}function r(){expect(p.options.crs).to.equal(L.CRS.EPSG3857),expect(L.CRS.EPSG3857.projection).to.equal(L.Projection.SphericalMercator),expect(L.Projection.SphericalMercator.MAX_LATITUDE).to.be.a("number");var e=p.getZoom();for(i=0;i<u.length;i++)try{expect(u[i].__parent._zoom).to.be.below(e)}catch(t){throw console.log("Failed marker: "+(i+1)),t}}var n,c,l,a,s,u,m,p,b,d,f;beforeEach(function(){for(f=L.Browser,d=sinon.useFakeTimers(),n=L.marker([1.5,-.4]),c=L.marker([1.5,.6]),l=L.marker([1.5,1.5]),a=L.marker([1.5,2.4]),s=L.marker([1.5,3.4]),u=[n,c,l,a,s],(m=document.createElement("div")).style.width="200px",m.style.height="200px",document.body.appendChild(m),(p=L.map(m,{maxZoom:18,trackResize:!1})).fitBounds(new L.LatLngBounds([[1,1],[2,2]])),i=0;i<u.length;i++)p.removeLayer(u[i].addTo(p))}),afterEach(function(){b instanceof L.MarkerClusterGroup&&(b.clearLayers(),p.removeLayer(b)),p.remove(),m.remove(),d.restore(),n=c=l=a=s=u=m=p=b=d=null}),it("removes objects more than 1 screen away from view port by default",function(){b=L.markerClusterGroup(),e(),expect(n._icon).to.be(null),expect(p._panes.markerPane.childNodes.length).to.be(3),expect(s._icon).to.be(null)}),it("removes objects out of view port by default for mobile device",function(){t();try{b=L.markerClusterGroup(),e(),expect(n._icon).to.be(null),expect(c._icon).to.be(null),expect(p._panes.markerPane.childNodes.length).to.be(1),expect(a._icon).to.be(null),expect(s._icon).to.be(null)}finally{L.Browser=f}}),it("leaves all objects on map when set to false",function(){b=L.markerClusterGroup({removeOutsideVisibleBounds:!1}),e(),expect(p._panes.markerPane.childNodes.length).to.be(5)});var h=[[100,3],[85.2,1.5],[85,0],[84.8,-1.5],[84.6,-3]];it("includes objects above the Web Mercator projection maximum limit by default",function(){o(h),b=L.markerClusterGroup(),e(),r(h),expect(p._panes.markerPane.childNodes.length).to.be(4),expect(s._icon).to.be(null)}),it("includes objects below the Web Mercator projection minimum limit by default",function(){o(h,!0),expect(p.getBounds().getNorth()).to.be.below(-80),b=L.markerClusterGroup(),e(),r(h),d.tick(1e3),expect(p._panes.markerPane.childNodes.length).to.be(4),expect(s._icon).to.be(null)});var x=[[100,1],[85.2,.5],[85,0],[84.9,-1],[84.8,-1.5]];it("includes objects above the Web Mercator projection maximum limit for mobile device",function(){t();try{o(x),b=L.markerClusterGroup({maxClusterRadius:10}),e(),r(x),expect(p._panes.markerPane.childNodes.length).to.be(3),expect(a._icon).to.be(null),expect(s._icon).to.be(null)}finally{L.Browser=f}}),it("includes objects below the Web Mercator projection minimum limit for mobile device",function(){t();try{o(x,!0),expect(p.getBounds().getNorth()).to.be.below(-80),b=L.markerClusterGroup({maxClusterRadius:10}),e(),r(x),expect(p._panes.markerPane.childNodes.length).to.be(3),expect(a._icon).to.be(null),expect(s._icon).to.be(null)}finally{L.Browser=f}})});