describe("Remember opacity",function(){var e,t,a,o,r,n=[{latLng:[0,0],opts:{opacity:.9}},{latLng:[0,1],opts:{opacity:.5}},{latLng:[0,-1],opts:{opacity:.5}},{latLng:[1,0],opts:{opacity:.5}},{latLng:[-1,0],opts:{opacity:.5}},{latLng:[1,1],opts:{opacity:.2}},{latLng:[1,-1],opts:{opacity:.2}},{latLng:[-1,1],opts:{opacity:.2}},{latLng:[-1,-1],opts:{opacity:.2}}],i=L.latLngBounds(L.latLng(-1.1,-1.1),L.latLng(1.1,1.1));beforeEach(function(){a=sinon.useFakeTimers(),(t=document.createElement("div")).style.width="200px",t.style.height="200px",document.body.appendChild(t),e=L.map(t,{maxZoom:18,trackResize:!1}),o=[];for(var r=0;r<n.length;r++)o.push(L.marker(n[r].latLng,n[r].opts))}),afterEach(function(){r.clearLayers(),e.removeLayer(r),e.remove(),document.body.removeChild(t),a.restore(),a=t=e=o=r=null}),it("clusters semitransparent markers into an opaque one",function(){e.setView(new L.LatLng(0,0),1),(r=new L.MarkerClusterGroup({maxClusterRadius:20})).addLayers(o),e.addLayer(r);var t=r._featureGroup.getLayers();expect(t.length).to.be(1),expect(t[0].options.opacity).to.be(1)}),it("unclusters an opaque marker into semitransparent ones",function(){var t;e.setView(new L.LatLng(0,0),1),(r=new L.MarkerClusterGroup({maxClusterRadius:20})).addLayers(o),e.addLayer(r),e.fitBounds(i),a.tick(1e3),t=r._featureGroup.getLayers(),expect(t.length).to.be(9);for(var n=0;n<9;n++)expect(t[n].options.opacity).to.be.within(.2,.9);e.setView(new L.LatLng(0,0),1),a.tick(1e3),e.fitBounds(i),a.tick(1e3),t=r._featureGroup.getLayers(),expect(t.length).to.be(9);for(n=0;n<9;n++)expect(t[n].options.opacity).to.be.within(.2,.9)}),it("has no problems zooming in and out several times",function(){var t;(r=new L.MarkerClusterGroup({maxClusterRadius:20})).addLayers(o),e.addLayer(r);for(var n=0;n<10;n++){e.fitBounds(i),a.tick(1e3),t=r._featureGroup.getLayers(),expect(t.length).to.be(9);for(n=0;n<9;n++)expect(t[n].options.opacity).to.be.within(.2,.9);e.setView(new L.LatLng(0,0),1),a.tick(1e3),t=r._featureGroup.getLayers(),expect(t.length).to.be(1),expect(t[0].options.opacity).to.be(1)}}),it("retains the opacity of each individual marker",function(){var t;e.setView(new L.LatLng(0,0),1),(r=new L.MarkerClusterGroup({maxClusterRadius:20})).addLayers(o),e.addLayer(r);for(var s=0;s<5;s++)e.fitBounds(i),a.tick(1e3),e.setView(new L.LatLng(0,0),1),a.tick(1e3);for(s=0;s<n.length;s++)e.setView(L.latLng(n[s].latLng),18),a.tick(1e3),t=r._featureGroup.getLayers(),expect(t.length).to.be(1),expect(t[0].options.opacity).to.be(n[s].opts.opacity)})});